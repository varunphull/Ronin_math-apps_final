<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ronin's Maths Interactive Tool</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #080d1a; --card: rgba(15,23,42,0.85); --border: rgba(99,102,241,0.18);
      --text: #e2e8f0; --muted: #64748b; --indigo: #6366f1; --indigo-light: #a5b4fc;
      --emerald: #10b981; --amber: #f59e0b; --rose: #f43f5e;
    }
    body { font-family: 'Space Grotesk', sans-serif; background: var(--bg); color: var(--text);
      background-image: linear-gradient(rgba(99,102,241,0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(99,102,241,0.04) 1px, transparent 1px);
      background-size: 32px 32px; min-height: 100vh; }
    .mono { font-family: 'JetBrains Mono', monospace; }
    /* Sliders */
    input[type=range] { -webkit-appearance:none; appearance:none; width:100%; height:5px;
      border-radius:4px; background:#1e293b; outline:none; cursor:pointer; }
    input[type=range]::-webkit-slider-thumb { -webkit-appearance:none; width:20px; height:20px;
      border-radius:50%; background:#6366f1; border:2px solid #fff; cursor:pointer; }
    input[type=number] { background:#0f172a; border:1px solid rgba(99,102,241,0.25);
      border-radius:8px; color:#f1f5f9; padding:6px 10px; width:70px; font-size:13px;
      font-family:'JetBrains Mono',monospace; text-align:center; outline:none; }
    input[type=number]:focus { border-color:#6366f1; }
    input[type=number]::-webkit-inner-spin-button { opacity:1; }
    /* Buttons */
    .btn { padding:6px 14px; border-radius:8px; font-size:13px; font-weight:600;
      cursor:pointer; border:none; transition:all 0.15s; font-family:'Space Grotesk',sans-serif; }
    .btn-tab { background:transparent; color:#64748b; }
    .btn-tab:hover { color:#94a3b8; }
    .btn-tab.active { background:rgba(99,102,241,0.25); color:#a5b4fc; }
    .btn-back { display:inline-flex; align-items:center; gap:6px; color:#64748b; font-size:14px;
      cursor:pointer; background:none; border:none; padding:0; margin-bottom:24px;
      font-family:'Space Grotesk',sans-serif; transition:color 0.15s; }
    .btn-back:hover { color:#e2e8f0; }
    /* Cards */
    .card { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:20px; }
    .topic-card { background:rgba(15,23,42,0.7); border:1px solid rgba(99,102,241,0.12);
      border-radius:16px; padding:20px; cursor:pointer; transition:all 0.2s; }
    .topic-card:hover { border-color:rgba(99,102,241,0.4); background:rgba(30,41,59,0.8); transform:translateY(-2px); }
    /* Formula box */
    .fbox { border-radius:12px; padding:16px; }
    /* Steps */
    .step { background:rgba(15,23,42,0.6); border:1px solid rgba(99,102,241,0.1);
      border-radius:10px; padding:12px 16px; margin-bottom:8px; cursor:pointer; }
    .step:hover { border-color:rgba(99,102,241,0.3); }
    .step-body { font-size:12px; color:#94a3b8; margin-top:8px; display:none; }
    .step.open .step-body { display:block; }
    /* Tab bar */
    .tab-bar { display:flex; gap:6px; background:rgba(15,23,42,0.6); padding:6px;
      border-radius:10px; border:1px solid rgba(99,102,241,0.15); flex-wrap:wrap; width:fit-content; margin-bottom:20px; }
    /* Layout */
    .page-wrap { min-height:100vh; padding:24px 16px; max-width:980px; margin:0 auto; }
    .two-col { display:grid; grid-template-columns:1fr 1fr; gap:24px; align-items:start; }
    @media(max-width:700px) { .two-col { grid-template-columns:1fr; } }
    .ctrl-col { display:flex; flex-direction:column; gap:14px; }
    /* SVG */
    svg { display:block; max-width:100%; border-radius:12px; }
    svg text { user-select:none; }
    /* Slider+input row */
    .si-row { margin-bottom:18px; }
    .si-label { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .si-label span:first-child { font-size:13px; font-weight:600; }
    .si-controls { display:flex; align-items:center; gap:10px; }
    .si-controls input[type=range] { flex:1; }
    /* Info box */
    .info-box { background:rgba(15,23,42,0.6); border:1px solid rgba(99,102,241,0.1); border-radius:12px; padding:16px; }
    .info-label { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:.08em; color:#475569; margin-bottom:8px; }
    /* Dashboard grid */
    .dash-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:16px; }
    /* Probability */
    .prob-ball { width:32px; height:32px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center;
      font-size:12px; font-weight:700; cursor:pointer; border:2px solid transparent; transition:all 0.15s; }
    /* Scrollable steps */
    .steps-wrap { max-height:280px; overflow-y:auto; padding-right:4px; }
    .steps-wrap::-webkit-scrollbar { width:4px; }
    .steps-wrap::-webkit-scrollbar-thumb { background:#1e293b; border-radius:4px; }
  </style>
</head>
<body>
<div id="app"></div>

<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let PAGE = 'dashboard';

const S = {
  grad:  { A:{x:-4,y:-3}, B:{x:4,y:4} },
  mid:   { A:{x:-5,y:-3}, B:{x:5,y:4} },
  bear:  { A:{x:0,y:0},   B:{x:4,y:6} },
  area:  { shape:'triangle', triA:{x:-5,y:-4}, triB:{x:5,y:-4}, triC:{x:0,y:5}, rectA:{x:-4,y:-3}, rectB:{x:4,y:4} },
  prism: { base:4, height:3, depth:5 },
  linear:{ m:1, c:0 },
  unit:  { value:10, dir:'mi2km' },
  trans: { type:'translate', shape:[{x:1,y:1},{x:4,y:1},{x:2.5,y:4}], tx:2, ty:1, angle:90, cx:0, cy:0, sf:2 },
  para:  { type:'parallelogram', b:6, h:4, a:3 },
  pct:   { original:80, pctChange:25, dir:'increase', findType:'new' },
  ratio: { a:3, b:5, total:160, simplA:12, simplB:18 },
  prob:  { mode:'single', balls:['red','red','red','blue','blue','green'], picked:null },
  circle:{ r:5, mode:'full', sector:90 },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COORDINATE HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const W=400, H=400, RANGE=10;
function toSVG(x,y,w=W,h=H,r=RANGE){ const c=w/(r*2); return {sx:w/2+x*c, sy:h/2-y*c}; }
function toMath(sx,sy,w=W,h=H,r=RANGE){ const c=w/(r*2); return {x:(sx-w/2)/c, y:(h/2-sy)/c}; }
function snap(v){ return Math.round(Math.max(-RANGE+1,Math.min(RANGE-1,v))); }
function r1(v){ return Math.round(v*10)/10; }
function r2(v){ return Math.round(v*100)/100; }
function gcd(a,b){ a=Math.abs(a);b=Math.abs(b); while(b){[a,b]=[b,a%b];} return a; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GRID DRAWING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawGrid(w=W,h=H,range=RANGE){
  const cell=w/(range*2), cx=w/2, cy=h/2;
  let s='';
  for(let i=-range;i<=range;i++){
    const x=cx+i*cell, y=cy+i*cell, axis=i===0;
    s+=`<line x1="${x}" y1="0" x2="${x}" y2="${h}" stroke="${axis?'#334155':'#1a2535'}" stroke-width="${axis?1.5:.5}"/>`;
    s+=`<line x1="0" y1="${y}" x2="${w}" y2="${y}" stroke="${axis?'#334155':'#1a2535'}" stroke-width="${axis?1.5:.5}"/>`;
    if(i!==0&&i%2===0){
      s+=`<text x="${x}" y="${cy+15}" text-anchor="middle" fill="#334155" font-size="9" font-family="Space Grotesk">${i}</text>`;
      s+=`<text x="${cx-10}" y="${y+3}" text-anchor="end" fill="#334155" font-size="9" font-family="Space Grotesk">${-i}</text>`;
    }
  }
  s+=`<polygon points="${w-6},${cy-3} ${w},${cy} ${w-6},${cy+3}" fill="#475569"/>`;
  s+=`<polygon points="${cx-3},6 ${cx},0 ${cx+3},6" fill="#475569"/>`;
  s+=`<text x="${w-4}" y="${cy-8}" fill="#475569" font-size="11" font-weight="600" text-anchor="end">x</text>`;
  s+=`<text x="${cx+10}" y="12" fill="#475569" font-size="11" font-weight="600">y</text>`;
  return s;
}

function makeSVG(inner,id,w=W,h=H){
  return `<svg id="${id}" width="${w}" height="${h}" viewBox="0 0 ${w} ${h}" style="background:#060b14;border-radius:12px;touch-action:none">${drawGrid(w,h)}${inner}</svg>`;
}

function dragDot(sx,sy,color,label,id,lx,ly){
  const tx=lx!==undefined?lx:sx+12, ty=ly!==undefined?ly:sy-14;
  return `<g class="dp" data-id="${id}" style="cursor:grab">
    <circle cx="${sx}" cy="${sy}" r="16" fill="${color}" opacity=".1"/>
    <circle cx="${sx}" cy="${sy}" r="7" fill="${color}" stroke="#fff" stroke-width="2"/>
    ${label?`<text x="${tx}" y="${ty}" fill="${color}" font-size="11" font-weight="700" font-family="Space Grotesk">${label}</text>`:''}
  </g>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DRAGGING ENGINE â€” updates SVG in-place, no full re-render
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _dragCleanup = null;

function attachDrag(svgId, onMove){
  if(_dragCleanup){ _dragCleanup(); _dragCleanup=null; }
  const svg = document.getElementById(svgId);
  if(!svg) return;

  let active = null;

  function getPos(e){
    const rect=svg.getBoundingClientRect();
    const t=e.touches?e.touches[0]:e;
    return { sx:(t.clientX-rect.left)*(W/rect.width), sy:(t.clientY-rect.top)*(H/rect.height) };
  }

  function onDown(e){
    const g=e.target.closest('.dp');
    if(!g) return;
    e.preventDefault();
    active=g.dataset.id;
  }
  function onMv(e){
    if(!active) return;
    e.preventDefault();
    const pos=getPos(e);
    const m=toMath(pos.sx,pos.sy);
    onMove(active, snap(m.x), snap(m.y));
  }
  function onUp(){ active=null; }

  svg.addEventListener('mousedown',onDown);
  svg.addEventListener('touchstart',onDown,{passive:false});
  window.addEventListener('mousemove',onMv);
  window.addEventListener('mouseup',onUp);
  window.addEventListener('touchmove',onMv,{passive:false});
  window.addEventListener('touchend',onUp);

  _dragCleanup=()=>{
    svg.removeEventListener('mousedown',onDown);
    svg.removeEventListener('touchstart',onDown);
    window.removeEventListener('mousemove',onMv);
    window.removeEventListener('mouseup',onUp);
    window.removeEventListener('touchmove',onMv);
    window.removeEventListener('touchend',onUp);
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI PRIMITIVES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const COLORS={
  indigo:['rgba(99,102,241,.12)','rgba(99,102,241,.35)','#a5b4fc','#818cf8'],
  emerald:['rgba(16,185,129,.12)','rgba(16,185,129,.35)','#6ee7b7','#34d399'],
  amber:['rgba(245,158,11,.12)','rgba(245,158,11,.35)','#fcd34d','#f59e0b'],
  rose:['rgba(244,63,94,.12)','rgba(244,63,94,.35)','#fda4af','#f43f5e'],
  violet:['rgba(139,92,246,.12)','rgba(139,92,246,.35)','#c4b5fd','#a78bfa'],
};

function fbox(title,formula,result,color='indigo'){
  const [bg,border,text,accent]=COLORS[color]||COLORS.indigo;
  return `<div style="background:${bg};border:1px solid ${border};border-radius:12px;padding:16px">
    <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:${accent};margin-bottom:5px">${title}</div>
    <div class="mono" style="font-size:12px;color:#94a3b8;margin-bottom:6px">${formula}</div>
    ${result!==undefined?`<div style="font-size:20px;font-weight:700;color:${text}">${result}</div>`:''}
  </div>`;
}

function steps(arr){
  return `<div class="steps-wrap">`+arr.map((s,i)=>`
    <div class="step" onclick="this.classList.toggle('open')">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-size:13px;font-weight:600;color:#e2e8f0">Step ${i+1}: ${s.t}</div>
        <span style="color:#64748b;font-size:10px">â–¼</span>
      </div>
      <div class="step-body mono">${s.c}</div>
    </div>`).join('')+`</div>`;
}

// slider + number input
function SI(label, color, val, min, max, step, key, subkey){
  const kk=subkey?`S.${key}.${subkey}=${subkey==='m'||subkey==='c'?'':''}parseFloat(this.value);rerender()`
    :`S.${key}=parseFloat(this.value);rerender()`;
  const id=`si_${key}_${subkey||'v'}`;
  return `<div class="si-row">
    <div class="si-label">
      <span style="color:${color}">${label}</span>
      <input type="number" min="${min}" max="${max}" step="${step}" value="${val}" 
        oninput="S.${subkey?key+'.'+subkey:key}=parseFloat(this.value)||0;document.getElementById('${id}').value=this.value;rerender()"
        style="width:70px">
    </div>
    <div class="si-controls">
      <input type="range" id="${id}" min="${min}" max="${max}" step="${step}" value="${val}"
        oninput="S.${subkey?key+'.'+subkey:key}=parseFloat(this.value);this.previousElementSibling&&(this.previousElementSibling.value=this.value);rerender()">
    </div>
  </div>`;
}

function tabs(items, activeVal, setExpr){
  return `<div class="tab-bar">`+items.map(([v,l])=>
    `<button class="btn btn-tab${activeVal===v?' active':''}" onclick="${setExpr.replace('__V__',`'${v}'`)}">${l}</button>`
  ).join('')+`</div>`;
}

function pageWrap(title,icon,sub,content){
  return `<div class="page-wrap">
    <button class="btn-back" onclick="navigate('dashboard')">â† Back to Topics</button>
    <div style="margin-bottom:24px">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:6px">
        <div style="width:40px;height:40px;border-radius:12px;background:rgba(99,102,241,.2);display:flex;align-items:center;justify-content:center;font-size:20px">${icon}</div>
        <h1 style="font-size:clamp(18px,3vw,26px);font-weight:700;color:#f1f5f9">${title}</h1>
      </div>
      <p style="color:#64748b;font-size:14px;margin-left:52px">${sub}</p>
    </div>
    ${content}
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboard(){
  const topics=[
    {icon:'ğŸ“ˆ',title:'Finding Gradient',desc:'Drag two points and watch gradient update live.',page:'gradient'},
    {icon:'ğŸ¯',title:'Midpoint of a Line',desc:'Find the exact middle between two coordinates.',page:'midpoint'},
    {icon:'ğŸ§­',title:'Bearings',desc:'Measure angles clockwise from North interactively.',page:'bearings'},
    {icon:'ğŸ”„',title:'2D Transformations',desc:'Translate, reflect, rotate and enlarge shapes.',page:'transformations'},
    {icon:'â¬¡',title:'Parallelogram & Trapezium',desc:'Compute areas with adjustable sliders.',page:'parallelogram'},
    {icon:'ğŸ“',title:'Area of Shapes',desc:'Drag vertices to compute triangle and rectangle areas.',page:'area'},
    {icon:'ğŸ“¦',title:'3D Prisms',desc:'Volume and surface area with live 3D diagram.',page:'prisms'},
    {icon:'â†”ï¸',title:'Miles â†” Kilometres',desc:'Convert between imperial and metric distances.',page:'units'},
    {icon:'ğŸ“‰',title:'Linear Equations',desc:'Adjust m and c in y = mx + c and watch the line move.',page:'linear'},
    {icon:'%',title:'Percentages',desc:'Percentage increase, decrease and reverse percentage.',page:'percentages'},
    {icon:'âš–ï¸',title:'Ratio & Proportion',desc:'Share amounts in a ratio and simplify ratios.',page:'ratio'},
    {icon:'ğŸ²',title:'Probability',desc:'Explore single and combined event probability.',page:'probability'},
    {icon:'â­•',title:'Circles',desc:'Area, circumference, arc length and sector area.',page:'circles'},
  ];
  return `<div class="page-wrap" style="max-width:980px">
    <div style="margin-bottom:36px">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
        <div style="width:44px;height:44px;border-radius:14px;background:rgba(99,102,241,.2);display:flex;align-items:center;justify-content:center;font-size:22px">ğŸ§®</div>
        <h1 style="font-size:clamp(20px,4vw,30px);font-weight:700;color:#f1f5f9">Ronin's Maths Interactive Tool</h1>
      </div>
      <p style="color:#64748b;font-size:14px;margin-left:56px">Cambridge IGCSE maths â€” drag, explore, and learn interactively.</p>
    </div>
    <div class="dash-grid">${topics.map(t=>`
      <div class="topic-card" onclick="navigate('${t.page}')">
        <div style="font-size:26px;margin-bottom:10px">${t.icon}</div>
        <div style="font-weight:700;color:#f1f5f9;font-size:15px;margin-bottom:5px">${t.title}</div>
        <div style="font-size:13px;color:#64748b;line-height:1.5">${t.desc}</div>
      </div>`).join('')}
    </div>
    <p style="text-align:center;color:#1e293b;font-size:12px;margin-top:28px">Drag points â€¢ Adjust sliders â€¢ Enter values manually</p>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GRADIENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderGradient(){
  const {A,B}=S.grad;
  const svA=toSVG(A.x,A.y), svB=toSVG(B.x,B.y);
  const dx=B.x-A.x, dy=B.y-A.y;
  const m=dx===0?'âˆ':r2(dy/dx);
  // extend line across full SVG
  let lx1=0,ly1,lx2=W,ly2;
  if(dx===0){lx1=lx2=svA.sx;ly1=0;ly2=H;}
  else{const slope=-dy/dx;ly1=svA.sy+slope*(svA.sx-lx1);ly2=svA.sy+slope*(svA.sx-lx2);}
  const inner=`
    <line x1="${lx1}" y1="${ly1}" x2="${lx2}" y2="${ly2}" stroke="#6366f1" stroke-width="1.5" opacity=".4" stroke-dasharray="6,4"/>
    <line x1="${svA.sx}" y1="${svA.sy}" x2="${svB.sx}" y2="${svB.sy}" stroke="#818cf8" stroke-width="2.5"/>
    <line x1="${svA.sx}" y1="${svA.sy}" x2="${svB.sx}" y2="${svA.sy}" stroke="#f59e0b" stroke-width="1.5" stroke-dasharray="4,3"/>
    <line x1="${svB.sx}" y1="${svA.sy}" x2="${svB.sx}" y2="${svB.sy}" stroke="#34d399" stroke-width="1.5" stroke-dasharray="4,3"/>
    <text x="${(svA.sx+svB.sx)/2}" y="${svA.sy+(svA.sy>svB.sy?-8:18)}" text-anchor="middle" fill="#f59e0b" font-size="11" font-weight="600" font-family="Space Grotesk">Î”x=${dx}</text>
    <text x="${svB.sx+14}" y="${(svA.sy+svB.sy)/2+4}" fill="#34d399" font-size="11" font-weight="600" font-family="Space Grotesk">Î”y=${dy}</text>
    ${dragDot(svA.sx,svA.sy,'#818cf8',`A(${A.x},${A.y})`,'grad-A')}
    ${dragDot(svB.sx,svB.sy,'#34d399',`B(${B.x},${B.y})`,'grad-B')}`;
  setTimeout(()=>attachDrag('svg-grad',(id,x,y)=>{
    if(id==='grad-A') S.grad.A={x,y}; else S.grad.B={x,y};
    rerender();
  }),30);
  return pageWrap('Finding Gradient','ğŸ“ˆ','Drag A and B to see the gradient update in real-time.',`
    <div class="two-col">
      ${makeSVG(inner,'svg-grad')}
      <div class="ctrl-col">
        ${fbox('Gradient','m = (yâ‚‚âˆ’yâ‚) / (xâ‚‚âˆ’xâ‚)',m==='âˆ'?'Undefined (vertical line)':m,'indigo')}
        ${fbox('Rise Î”y','yâ‚‚ âˆ’ yâ‚ = '+B.y+' âˆ’ '+A.y,dy,'emerald')}
        ${fbox('Run Î”x','xâ‚‚ âˆ’ xâ‚ = '+B.x+' âˆ’ '+A.x,dx,'amber')}
        <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:#475569">Step-by-step</div>
        ${steps([
          {t:'Label points',c:`A=(${A.x},${A.y}), B=(${B.x},${B.y})`},
          {t:'Find rise Î”y',c:`${B.y} âˆ’ ${A.y} = ${dy}`},
          {t:'Find run Î”x',c:`${B.x} âˆ’ ${A.x} = ${dx}`},
          {t:'Calculate m',c:`m = ${dy}/${dx} = ${m}`},
        ])}
      </div>
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MIDPOINT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderMidpoint(){
  const {A,B}=S.mid;
  const svA=toSVG(A.x,A.y), svB=toSVG(B.x,B.y);
  const mx=r1((A.x+B.x)/2), my=r1((A.y+B.y)/2);
  const svM=toSVG(mx,my);
  const inner=`
    <line x1="${svA.sx}" y1="${svA.sy}" x2="${svB.sx}" y2="${svB.sy}" stroke="#818cf8" stroke-width="2.5"/>
    <circle cx="${svM.sx}" cy="${svM.sy}" r="9" fill="#fbbf24" stroke="#fff" stroke-width="2"/>
    <text x="${svM.sx+14}" y="${svM.sy-10}" fill="#fbbf24" font-size="12" font-weight="700" font-family="Space Grotesk">M(${mx},${my})</text>
    ${dragDot(svA.sx,svA.sy,'#818cf8',`A(${A.x},${A.y})`,'mid-A')}
    ${dragDot(svB.sx,svB.sy,'#34d399',`B(${B.x},${B.y})`,'mid-B')}`;
  setTimeout(()=>attachDrag('svg-mid',(id,x,y)=>{
    if(id==='mid-A') S.mid.A={x,y}; else S.mid.B={x,y}; rerender();
  }),30);
  return pageWrap('Midpoint of a Line','ğŸ¯','Drag A and B to find their midpoint M.',`
    <div class="two-col">
      ${makeSVG(inner,'svg-mid')}
      <div class="ctrl-col">
        ${fbox('Midpoint','M = ((xâ‚+xâ‚‚)/2 , (yâ‚+yâ‚‚)/2)',`(${mx}, ${my})`,'amber')}
        ${fbox('Midpoint x','('+A.x+' + '+B.x+') / 2',mx,'indigo')}
        ${fbox('Midpoint y','('+A.y+' + '+B.y+') / 2',my,'emerald')}
        ${steps([
          {t:'Label points',c:`A=(${A.x},${A.y}), B=(${B.x},${B.y})`},
          {t:'Average x-coords',c:`(${A.x}+${B.x})/2 = ${mx}`},
          {t:'Average y-coords',c:`(${A.y}+${B.y})/2 = ${my}`},
          {t:'Midpoint',c:`M = (${mx}, ${my})`},
        ])}
      </div>
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BEARINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderBearings(){
  const {A,B}=S.bear;
  const svA=toSVG(A.x,A.y), svB=toSVG(B.x,B.y);
  const svN=toSVG(A.x,A.y+3.5);
  const dx=B.x-A.x, dy=B.y-A.y;
  const dist=r2(Math.sqrt(dx*dx+dy*dy));
  let ang=Math.atan2(dx,dy)*180/Math.PI; if(ang<0)ang+=360;
  const bearing=Math.round(ang), bs=bearing.toString().padStart(3,'0');
  const arcR=50, s0=(-90)*Math.PI/180, s1=(-90+bearing)*Math.PI/180;
  const ax1=svA.sx+arcR*Math.cos(s0), ay1=svA.sy+arcR*Math.sin(s0);
  const ax2=svA.sx+arcR*Math.cos(s1), ay2=svA.sy+arcR*Math.sin(s1);
  const inner=`
    <line x1="${svA.sx}" y1="${svA.sy}" x2="${svN.sx}" y2="${svN.sy}" stroke="#475569" stroke-width="2" stroke-dasharray="5,4"/>
    <text x="${svN.sx}" y="${svN.sy-8}" text-anchor="middle" fill="#64748b" font-size="13" font-weight="700" font-family="Space Grotesk">N</text>
    <line x1="${svA.sx}" y1="${svA.sy}" x2="${svB.sx}" y2="${svB.sy}" stroke="#818cf8" stroke-width="2.5"/>
    <path d="M ${ax1} ${ay1} A ${arcR} ${arcR} 0 ${bearing>180?1:0} 1 ${ax2} ${ay2}" fill="none" stroke="#fbbf24" stroke-width="2.5"/>
    <text x="${svA.sx+58}" y="${svA.sy-14}" fill="#fbbf24" font-size="14" font-weight="700" font-family="Space Grotesk">${bs}Â°</text>
    ${dragDot(svA.sx,svA.sy,'#f43f5e',`A(${A.x},${A.y})`,'bear-A')}
    ${dragDot(svB.sx,svB.sy,'#818cf8',`B(${B.x},${B.y})`,'bear-B')}`;
  setTimeout(()=>attachDrag('svg-bear',(id,x,y)=>{
    if(id==='bear-A') S.bear.A={x,y}; else S.bear.B={x,y}; rerender();
  }),30);
  return pageWrap('Bearings','ğŸ§­','Drag A (origin) and B (target) to see the bearing update.',`
    <div class="two-col">
      ${makeSVG(inner,'svg-bear')}
      <div class="ctrl-col">
        ${fbox('Bearing A â†’ B','Clockwise from North',bs+'Â°','indigo')}
        ${fbox('Distance','d = âˆš(Î”xÂ² + Î”yÂ²)',dist+' units','emerald')}
        <div class="info-box">
          <div class="info-label">Compass Reference</div>
          <div style="font-size:13px;color:#94a3b8;line-height:1.9">N = 000Â° &nbsp;E = 090Â°<br>S = 180Â° &nbsp;W = 270Â°</div>
        </div>
        ${steps([
          {t:'Mark A and B',c:`A=(${A.x},${A.y}), B=(${B.x},${B.y})`},
          {t:'Draw North from A',c:'Always measure from North (000Â°)'},
          {t:'Measure clockwise',c:`Î”x=${dx}, Î”y=${dy}`},
          {t:'Three-figure bearing',c:`${bs}Â°`},
        ])}
      </div>
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AREA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderArea(){
  const s=S.area;
  let inner='', right='';
  if(s.shape==='triangle'){
    const {triA:A,triB:B,triC:C}=s;
    const svA=toSVG(A.x,A.y),svB=toSVG(B.x,B.y),svC=toSVG(C.x,C.y);
    const area=r2(Math.abs(A.x*(B.y-C.y)+B.x*(C.y-A.y)+C.x*(A.y-B.y))/2);
    inner=`<polygon points="${svA.sx},${svA.sy} ${svB.sx},${svB.sy} ${svC.sx},${svC.sy}" fill="#f59e0b" fill-opacity=".12" stroke="#f59e0b" stroke-width="2"/>
      ${dragDot(svA.sx,svA.sy,'#818cf8',`A(${A.x},${A.y})`,'area-tA')}
      ${dragDot(svB.sx,svB.sy,'#34d399',`B(${B.x},${B.y})`,'area-tB')}
      ${dragDot(svC.sx,svC.sy,'#f59e0b',`C(${C.x},${C.y})`,'area-tC')}`;
    right=fbox('Triangle Area (Shoelace)','Â½|xâ‚(yâ‚‚âˆ’yâ‚ƒ)+xâ‚‚(yâ‚ƒâˆ’yâ‚)+xâ‚ƒ(yâ‚âˆ’yâ‚‚)|',area+' sq units','amber')+
      steps([
        {t:'Label vertices',c:`A(${A.x},${A.y}), B(${B.x},${B.y}), C(${C.x},${C.y})`},
        {t:'Apply Shoelace',c:'Area = Â½|xâ‚(yâ‚‚âˆ’yâ‚ƒ)+xâ‚‚(yâ‚ƒâˆ’yâ‚)+xâ‚ƒ(yâ‚âˆ’yâ‚‚)|'},
        {t:'Substitute',c:`= Â½|${A.x}(${B.y-C.y})+${B.x}(${C.y-A.y})+${C.x}(${A.y-B.y})|`},
        {t:'Result',c:`Area = ${area} square units`},
      ]);
    setTimeout(()=>attachDrag('svg-area',(id,x,y)=>{
      if(id==='area-tA') s.triA={x,y};
      else if(id==='area-tB') s.triB={x,y};
      else if(id==='area-tC') s.triC={x,y};
      rerender();
    }),30);
  } else {
    const {rectA:A,rectB:B}=s;
    const svA=toSVG(A.x,A.y),svB=toSVG(B.x,B.y);
    const w=Math.abs(B.x-A.x),h=Math.abs(B.y-A.y),area=w*h;
    const minX=Math.min(svA.sx,svB.sx),minY=Math.min(svA.sy,svB.sy);
    inner=`<rect x="${minX}" y="${minY}" width="${Math.abs(svB.sx-svA.sx)}" height="${Math.abs(svB.sy-svA.sy)}" fill="#818cf8" fill-opacity=".12" stroke="#818cf8" stroke-width="2"/>
      <text x="${minX+Math.abs(svB.sx-svA.sx)/2}" y="${Math.max(svA.sy,svB.sy)+16}" text-anchor="middle" fill="#f59e0b" font-size="11" font-weight="600" font-family="Space Grotesk">w=${w}</text>
      <text x="${Math.max(svA.sx,svB.sx)+14}" y="${minY+Math.abs(svB.sy-svA.sy)/2+4}" fill="#34d399" font-size="11" font-weight="600" font-family="Space Grotesk">h=${h}</text>
      ${dragDot(svA.sx,svA.sy,'#818cf8',`A(${A.x},${A.y})`,'area-rA')}
      ${dragDot(svB.sx,svB.sy,'#34d399',`B(${B.x},${B.y})`,'area-rB')}`;
    right=fbox('Rectangle Area','A = width Ã— height',area+' sq units','indigo')+
      `<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
        ${fbox('Width','|xâ‚‚âˆ’xâ‚|',w,'amber')}${fbox('Height','|yâ‚‚âˆ’yâ‚|',h,'emerald')}</div>`+
      steps([
        {t:'Corners',c:`A(${A.x},${A.y}), B(${B.x},${B.y})`},
        {t:'Width',c:`|${B.x}âˆ’${A.x}| = ${w}`},
        {t:'Height',c:`|${B.y}âˆ’${A.y}| = ${h}`},
        {t:'Area',c:`${w} Ã— ${h} = ${area} sq units`},
      ]);
    setTimeout(()=>attachDrag('svg-area',(id,x,y)=>{
      if(id==='area-rA') s.rectA={x,y}; else s.rectB={x,y}; rerender();
    }),30);
  }
  return pageWrap('Area of Shapes','ğŸ“','Drag vertices to reshape and recalculate.',`
    ${tabs([['triangle','Triangle'],['rectangle','Rectangle']],s.shape,"S.area.shape=__V__;rerender()")}
    <div class="two-col">${makeSVG(inner,'svg-area')}<div class="ctrl-col">${right}</div></div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRISMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPrisms(){
  const {base:b,height:h,depth:d}=S.prism;
  const triA=r2((b*h)/2), vol=r2(triA*d);
  const hyp=r2(Math.sqrt(b*b+h*h));
  const sa=r2(2*triA+b*d+h*d+hyp*d);
  const sc=15,pcx=200,pcy=185,bw=b*sc,th=h*sc,doff=d*9;
  const fT={x:pcx,y:pcy-th},fL={x:pcx-bw/2,y:pcy},fR={x:pcx+bw/2,y:pcy};
  const bT={x:fT.x+doff,y:fT.y-doff*.45},bL={x:fL.x+doff,y:fL.y-doff*.45},bR={x:fR.x+doff,y:fR.y-doff*.45};
  const prismSVG=`<svg width="${W}" height="320" viewBox="0 0 ${W} 320" style="background:#060b14;border-radius:12px;display:block;max-width:100%">
    <defs><linearGradient id="pg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#818cf8" stop-opacity=".5"/>
      <stop offset="100%" stop-color="#4f46e5" stop-opacity=".2"/></linearGradient></defs>
    <polygon points="${fT.x},${fT.y} ${fL.x},${fL.y} ${fR.x},${fR.y}" fill="url(#pg)" stroke="#818cf8" stroke-width="2"/>
    <polygon points="${bT.x},${bT.y} ${bL.x},${bL.y} ${bR.x},${bR.y}" fill="#4f46e5" fill-opacity=".2" stroke="#818cf8" stroke-width="1.5" stroke-dasharray="5,4"/>
    <line x1="${fT.x}" y1="${fT.y}" x2="${bT.x}" y2="${bT.y}" stroke="#818cf8" stroke-width="2"/>
    <line x1="${fL.x}" y1="${fL.y}" x2="${bL.x}" y2="${bL.y}" stroke="#818cf8" stroke-width="2"/>
    <line x1="${fR.x}" y1="${fR.y}" x2="${bR.x}" y2="${bR.y}" stroke="#818cf8" stroke-width="2"/>
    <text x="${pcx}" y="${pcy+18}" text-anchor="middle" fill="#f59e0b" font-size="12" font-weight="600" font-family="Space Grotesk">base=${b}</text>
    <text x="${fR.x+10}" y="${(fR.y+fT.y)/2}" fill="#10b981" font-size="12" font-weight="600" font-family="Space Grotesk">h=${h}</text>
    <text x="${(fL.x+bL.x)/2-8}" y="${(fL.y+bL.y)/2-4}" fill="#f43f5e" font-size="12" font-weight="600" font-family="Space Grotesk">d=${d}</text>
  </svg>`;
  return pageWrap('3D Prisms','ğŸ“¦','Adjust sliders or enter values to recalculate.',`
    <div class="two-col">
      ${prismSVG}
      <div class="ctrl-col">
        <div class="card">
          ${SI('Triangle Base','#f59e0b',b,1,10,1,'prism','base')}
          ${SI('Triangle Height','#10b981',h,1,10,1,'prism','height')}
          ${SI('Prism Depth','#f43f5e',d,1,12,1,'prism','depth')}
        </div>
        ${fbox('Volume','V = Â½ Ã— base Ã— height Ã— depth',vol+' cubic units','indigo')}
        ${fbox('Surface Area','SA = 2 triangles + 3 rectangles',sa+' sq units','emerald')}
        ${steps([
          {t:'Triangle base area',c:`Â½ Ã— ${b} Ã— ${h} = ${triA}`},
          {t:'Volume',c:`${triA} Ã— ${d} = ${vol} cubic units`},
          {t:'Three rectangles',c:`${b}Ã—${d} + ${h}Ã—${d} + ${hyp}Ã—${d} = ${r2(b*d+h*d+hyp*d)}`},
          {t:'Surface area',c:`2Ã—${triA} + ${r2(b*d+h*d+hyp*d)} = ${sa} sq units`},
        ])}
      </div>
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LINEAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLinear(){
  const {m,c}=S.linear;
  // Clamp line to SVG bounds
  function lineY(x){ return m*x+c; }
  let pts=[];
  for(let x=-RANGE;x<=RANGE;x+=0.5){
    const y=lineY(x);
    if(y>=-RANGE&&y<=RANGE) pts.push(toSVG(x,y));
  }
  const pathD=pts.length?'M'+pts.map(p=>`${p.sx},${p.sy}`).join('L'):'';
  const yIntSV=toSVG(0,c);
  const xInt=m!==0?r2(-c/m):null;
  const inner=`
    ${pathD?`<path d="${pathD}" fill="none" stroke="#818cf8" stroke-width="2.5" stroke-linecap="round"/>`:''}
    <circle cx="${yIntSV.sx}" cy="${yIntSV.sy}" r="7" fill="#fbbf24" stroke="#fff" stroke-width="2"/>
    <text x="${yIntSV.sx+12}" y="${yIntSV.sy-10}" fill="#fbbf24" font-size="11" font-weight="600" font-family="Space Grotesk">c=${c}</text>`;
  return pageWrap('Linear Equations','ğŸ“‰','Adjust m and c to change the line y = mx + c.',`
    <div class="two-col">
      ${makeSVG(inner,'svg-lin')}
      <div class="ctrl-col">
        <div class="card">
          ${SI('Gradient (m)','#818cf8',m,-6,6,0.5,'linear','m')}
          ${SI('y-intercept (c)','#fbbf24',c,-9,9,1,'linear','c')}
        </div>
        ${fbox('Equation','y = mx + c',`y = ${m}x + (${c})`,'indigo')}
        ${fbox('y-intercept','Where line crosses y-axis','(0, '+c+')','amber')}
        ${xInt!==null?fbox('x-intercept','Where line crosses x-axis (y=0)','('+xInt+', 0)','emerald'):''}
        <div class="info-box">
          <div class="info-label">Key Facts</div>
          <div style="font-size:13px;color:#94a3b8;line-height:1.8">
            m = ${m} â†’ ${m>0?'slopes up â†—':m<0?'slopes down â†˜':'horizontal â†”'}<br>
            c = ${c} â†’ crosses y-axis at ${c}<br>
            ${Math.abs(m)>1?'Steep line':'${Math.abs(m)<1?"Shallow line":"45Â° line"}'}
          </div>
        </div>
      </div>
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UNITS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderUnits(){
  const {value:v,dir}=S.unit;
  const km=r2(v*1.60934), mi=r2(v/1.60934);
  return pageWrap('Miles â†” Kilometres','â†”ï¸','Convert between imperial and metric distance.',`
    <div style="max-width:520px">
      <div class="card" style="margin-bottom:20px">
        ${SI('Value','#818cf8',v,1,500,1,'unit','value')}
        <div style="display:flex;gap:8px;margin-top:4px">
          <button class="btn btn-tab${dir==='mi2km'?' active':''}" onclick="S.unit.dir='mi2km';rerender()">Miles â†’ Km</button>
          <button class="btn btn-tab${dir==='km2mi'?' active':''}" onclick="S.unit.dir='km2mi';rerender()">Km â†’ Miles</button>
        </div>
      </div>
      ${dir==='mi2km'
        ? fbox('Miles to Kilometres',v+' Ã— 1.60934',km+' km','indigo')
        : fbox('Kilometres to Miles',v+' Ã· 1.60934',mi+' miles','emerald')}
      <div class="info-box" style="margin-top:16px">
        <div class="info-label">Quick Reference</div>
        <div style="font-size:13px;color:#94a3b8;line-height:1.9">
          1 mile = 1.60934 km &nbsp;|&nbsp; 1 km = 0.621 miles<br>
          5 miles â‰ˆ 8 km &nbsp;|&nbsp; Marathon = 26.2 mi = 42.2 km
        </div>
      </div>
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARALLELOGRAM & TRAPEZIUM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderParallelogram(){
  const {type,b,h,a}=S.para;
  const svgW=380, svgH=260;
  let shape='', area, formula;
  const sc=22;
  if(type==='parallelogram'){
    area=r2(b*h); formula='A = base Ã— height';
    const ox=40,oy=200,slant=Math.min(30,h*8);
    const pts=`${ox},${oy} ${ox+b*sc},${oy} ${ox+b*sc+slant},${oy-h*sc} ${ox+slant},${oy-h*sc}`;
    shape=`<polygon points="${pts}" fill="rgba(99,102,241,.15)" stroke="#818cf8" stroke-width="2"/>
      <line x1="${ox}" y1="${oy+14}" x2="${ox+b*sc}" y2="${oy+14}" stroke="#f59e0b" stroke-width="1.5"/>
      <text x="${ox+b*sc/2}" y="${oy+26}" text-anchor="middle" fill="#f59e0b" font-size="11" font-weight="600" font-family="Space Grotesk">base=${b}</text>
      <line x1="${ox+b*sc+slant+12}" y1="${oy}" x2="${ox+b*sc+slant+12}" y2="${oy-h*sc}" stroke="#10b981" stroke-width="1.5" stroke-dasharray="4,3"/>
      <text x="${ox+b*sc+slant+24}" y="${oy-h*sc/2+4}" fill="#10b981" font-size="11" font-weight="600" font-family="Space Grotesk">h=${h}</text>`;
  } else {
    area=r2(0.5*(b+a)*h); formula='A = Â½(a+b) Ã— h';
    const ox=30,oy=200,off=Math.min(25,a*sc/3);
    const pts=`${ox},${oy} ${ox+b*sc},${oy} ${ox+b*sc-off},${oy-h*sc} ${ox+off},${oy-h*sc}`;
    shape=`<polygon points="${pts}" fill="rgba(244,63,94,.15)" stroke="#f43f5e" stroke-width="2"/>
      <line x1="${ox}" y1="${oy+14}" x2="${ox+b*sc}" y2="${oy+14}" stroke="#f59e0b" stroke-width="1.5"/>
      <text x="${ox+b*sc/2}" y="${oy+26}" text-anchor="middle" fill="#f59e0b" font-size="11" font-weight="600" font-family="Space Grotesk">b=${b}</text>
      <line x1="${ox+off}" y1="${oy-h*sc-14}" x2="${ox+b*sc-off}" y2="${oy-h*sc-14}" stroke="#818cf8" stroke-width="1.5"/>
      <text x="${ox+(b*sc)/2}" y="${oy-h*sc-20}" text-anchor="middle" fill="#818cf8" font-size="11" font-weight="600" font-family="Space Grotesk">a=${a}</text>
      <line x1="${ox+b*sc+8}" y1="${oy}" x2="${ox+b*sc+8}" y2="${oy-h*sc}" stroke="#10b981" stroke-width="1.5" stroke-dasharray="4,3"/>
      <text x="${ox+b*sc+20}" y="${oy-h*sc/2+4}" fill="#10b981" font-size="11" font-weight="600" font-family="Space Grotesk">h=${h}</text>`;
  }
  const color=type==='parallelogram'?'indigo':'rose';
  return pageWrap('Parallelogram & Trapezium','â¬¡','Adjust dimensions to compute area.',`
    ${tabs([['parallelogram','Parallelogram'],['trapezium','Trapezium']],type,"S.para.type=__V__;rerender()")}
    <div class="two-col">
      <svg width="${svgW}" height="${svgH}" viewBox="0 0 ${svgW} ${svgH}" style="background:#060b14;border-radius:12px;display:block;max-width:100%">${shape}</svg>
      <div class="ctrl-col">
        <div class="card">
          ${SI('Base (b)','#f59e0b',b,1,12,1,'para','b')}
          ${SI('Height (h)','#10b981',h,1,8,1,'para','h')}
          ${type==='trapezium'?SI('Top (a)','#818cf8',a,1,10,1,'para','a'):''}
        </div>
        ${fbox(type.charAt(0).toUpperCase()+type.slice(1)+' Area',formula,area+' sq units',color)}
        ${steps(type==='parallelogram'?[
          {t:'Formula',c:'A = base Ã— height'},
          {t:'Substitute',c:`A = ${b} Ã— ${h}`},
          {t:'Result',c:`A = ${area} sq units`},
        ]:[
          {t:'Formula',c:'A = Â½(a+b) Ã— h'},
          {t:'Substitute',c:`A = Â½(${a}+${b}) Ã— ${h}`},
          {t:'Simplify',c:`A = Â½ Ã— ${a+b} Ã— ${h}`},
          {t:'Result',c:`A = ${area} sq units`},
        ])}
      </div>
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRANSFORMATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTransformations(){
  const {type,shape,tx,ty,angle,cx:rcx,cy:rcy,sf}=S.trans;
  const rad=angle*Math.PI/180;
  let transformed=[];
  if(type==='translate') transformed=shape.map(p=>({x:r1(p.x+tx),y:r1(p.y+ty)}));
  else if(type==='reflect-x') transformed=shape.map(p=>({x:p.x,y:-p.y}));
  else if(type==='reflect-y') transformed=shape.map(p=>({x:-p.x,y:p.y}));
  else if(type==='rotate') transformed=shape.map(p=>({
    x:r1((p.x-rcx)*Math.cos(rad)-(p.y-rcy)*Math.sin(rad)+rcx),
    y:r1((p.x-rcx)*Math.sin(rad)+(p.y-rcy)*Math.cos(rad)+rcy),
  }));
  else if(type==='enlarge') transformed=shape.map(p=>({
    x:r1(rcx+(p.x-rcx)*sf), y:r1(rcy+(p.y-rcy)*sf),
  }));
  const pts=shape.map(p=>{const s=toSVG(p.x,p.y);return `${s.sx},${s.sy}`;}).join(' ');
  const tpts=transformed.map(p=>{const s=toSVG(p.x,p.y);return `${s.sx},${s.sy}`;}).join(' ');
  const inner=`
    <polygon points="${pts}" fill="rgba(99,102,241,.15)" stroke="#818cf8" stroke-width="2" stroke-dasharray="6,4"/>
    <polygon points="${tpts}" fill="rgba(16,185,129,.2)" stroke="#34d399" stroke-width="2.5"/>
    <text x="8" y="18" fill="#818cf8" font-size="11" font-weight="600" font-family="Space Grotesk">â–£ Original</text>
    <text x="8" y="34" fill="#34d399" font-size="11" font-weight="600" font-family="Space Grotesk">â–£ Transformed</text>`;
  const typeList=[['translate','Translate'],['reflect-x','Reflect x-axis'],['reflect-y','Reflect y-axis'],['rotate','Rotate'],['enlarge','Enlarge']];
  let controls='';
  if(type==='translate') controls=SI('x shift (tx)','#818cf8',tx,-8,8,1,'trans','tx')+SI('y shift (ty)','#34d399',ty,-8,8,1,'trans','ty');
  else if(type==='rotate') controls=SI('Angle (Â°)','#818cf8',angle,0,360,15,'trans','angle')+SI('Centre x','#f59e0b',rcx,-5,5,1,'trans','cx')+SI('Centre y','#f43f5e',rcy,-5,5,1,'trans','cy');
  else if(type==='enlarge') controls=SI('Scale factor','#818cf8',sf,0.5,4,.5,'trans','sf')+SI('Centre x','#f59e0b',rcx,-5,5,1,'trans','cx')+SI('Centre y','#f43f5e',rcy,-5,5,1,'trans','cy');
  const desc={translate:`Translate by vector (${tx}, ${ty})`,'reflect-x':'Reflect in the x-axis (y=0)','reflect-y':'Reflect in the y-axis (x=0)',rotate:`Rotate ${angle}Â° anticlockwise about (${rcx},${rcy})`,enlarge:`Enlarge by scale factor ${sf} about (${rcx},${rcy})`};
  return pageWrap('2D Transformations','ğŸ”„','Select a transformation type and adjust parameters.',`
    ${tabs(typeList,type,"S.trans.type=__V__;rerender()")}
    <div class="two-col">
      ${makeSVG(inner,'svg-trans')}
      <div class="ctrl-col">
        ${controls?`<div class="card">${controls}</div>`:''}
        ${fbox('Transformation',desc[type],'Blue â†’ Green','indigo')}
        <div class="info-box">
          <div class="info-label">Transformed Vertices</div>
          ${transformed.map((p,i)=>`<div style="font-size:13px;color:#94a3b8" class="mono">P${i+1}: (${p.x}, ${p.y})</div>`).join('')}
        </div>
      </div>
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERCENTAGES (NEW)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPercentages(){
  const {original:orig,pctChange:pct,dir,findType}=S.pct;
  let result, formula, stepArr;
  if(findType==='new'){
    const mult=dir==='increase'?1+pct/100:1-pct/100;
    result=r2(orig*mult);
    formula=dir==='increase'?`${orig} Ã— (1 + ${pct}/100)`:`${orig} Ã— (1 âˆ’ ${pct}/100)`;
    stepArr=[
      {t:'Identify original and percentage',c:`Original = ${orig}, Change = ${pct}%`},
      {t:'Convert % to multiplier',c:dir==='increase'?`1 + ${pct}/100 = ${mult}`:`1 âˆ’ ${pct}/100 = ${mult}`},
      {t:'Multiply',c:`${orig} Ã— ${mult} = ${result}`},
      {t:'New value',c:`After ${pct}% ${dir}: ${result}`},
    ];
  } else if(findType==='change'){
    result=r2(pct/100*orig);
    formula=`${pct}/100 Ã— ${orig}`;
    stepArr=[
      {t:'Find percentage amount',c:`${pct}% of ${orig}`},
      {t:'Convert to decimal',c:`${pct} Ã· 100 = ${pct/100}`},
      {t:'Multiply by original',c:`${pct/100} Ã— ${orig} = ${result}`},
    ];
  } else {
    // reverse: original is the "new value", find the original
    const mult=dir==='increase'?1+pct/100:1-pct/100;
    result=r2(orig/mult);
    formula=dir==='increase'?`${orig} Ã· (1 + ${pct}/100)`:`${orig} Ã· (1 âˆ’ ${pct}/100)`;
    stepArr=[
      {t:'New value after '+pct+'% '+dir,c:`New value = ${orig}`},
      {t:'Multiplier',c:dir==='increase'?`1 + ${pct}/100 = ${mult}`:`1 âˆ’ ${pct}/100 = ${mult}`},
      {t:'Divide to reverse',c:`${orig} Ã· ${mult} = ${result}`},
      {t:'Original value',c:`Original = ${result}`},
    ];
  }
  // Visual bar
  const barPct=Math.min(100,Math.max(0,pct));
  const barColor=dir==='increase'?'#10b981':'#f43f5e';
  return pageWrap('Percentages','%','Work out percentage change, amounts and reverse percentages.',`
    ${tabs([['new','New Value'],['change','% Amount'],['reverse','Reverse %']],findType,"S.pct.findType=__V__;rerender()")}
    <div class="two-col">
      <div class="ctrl-col">
        <div class="card">
          ${SI('Original Value','#818cf8',orig,1,1000,1,'pct','original')}
          ${SI('Percentage (%)','#f59e0b',pct,1,200,1,'pct','pctChange')}
          <div style="display:flex;gap:8px;margin-top:4px">
            <button class="btn btn-tab${dir==='increase'?' active':''}" onclick="S.pct.dir='increase';rerender()">Increase</button>
            <button class="btn btn-tab${dir==='decrease'?' active':''}" onclick="S.pct.dir='decrease';rerender()">Decrease</button>
          </div>
        </div>
        <!-- Visual bar -->
        <div class="info-box">
          <div class="info-label">Visual</div>
          <div style="background:#1e293b;border-radius:6px;height:24px;position:relative;overflow:hidden;margin-bottom:8px">
            <div style="width:${Math.min(100,orig/10)}%;background:#475569;height:100%"></div>
          </div>
          <div style="font-size:12px;color:#64748b">Original: ${orig}</div>
          <div style="background:#1e293b;border-radius:6px;height:24px;position:relative;overflow:hidden;margin-top:6px">
            <div style="width:${Math.min(100,result/10)}%;background:${barColor};height:100%;transition:width .3s"></div>
          </div>
          <div style="font-size:12px;color:${barColor};margin-top:4px">Result: ${result}</div>
        </div>
      </div>
      <div class="ctrl-col">
        ${fbox(findType==='new'?`New value after ${pct}% ${dir}`:findType==='change'?`${pct}% of ${orig}`:`Original before ${pct}% ${dir}`,formula,result,dir==='increase'?'emerald':'rose')}
        ${steps(stepArr)}
      </div>
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RATIO & PROPORTION (NEW)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRatio(){
  const {a,b,total,simplA,simplB}=S.ratio;
  const shareA=r2(total*a/(a+b)), shareB=r2(total*b/(a+b));
  const g=gcd(simplA,simplB);
  const sA=simplA/g, sB=simplB/g;
  const wA=Math.round(a/(a+b)*100), wB=100-wA;
  return pageWrap('Ratio & Proportion','âš–ï¸','Share amounts in a ratio and simplify ratios.',`
    ${tabs([['share','Share Amount'],['simplify','Simplify Ratio']],S.ratio.mode||'share',"S.ratio.mode=__V__;rerender()")}
    <div class="two-col">
      <div class="ctrl-col">
        ${(S.ratio.mode||'share')==='share'?`
        <div class="card">
          ${SI('Ratio Part A','#818cf8',a,1,20,1,'ratio','a')}
          ${SI('Ratio Part B','#34d399',b,1,20,1,'ratio','b')}
          ${SI('Total Amount','#f59e0b',total,1,1000,10,'ratio','total')}
        </div>
        <div class="info-box">
          <div class="info-label">Visual Split</div>
          <div style="display:flex;border-radius:8px;overflow:hidden;height:32px;margin-bottom:8px">
            <div style="width:${wA}%;background:#818cf8;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff">${a}</div>
            <div style="width:${wB}%;background:#34d399;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff">${b}</div>
          </div>
          <div style="font-size:12px;color:#64748b">Ratio ${a} : ${b} (total parts = ${a+b})</div>
        </div>`:`
        <div class="card">
          ${SI('First Number','#818cf8',simplA,1,200,1,'ratio','simplA')}
          ${SI('Second Number','#34d399',simplB,1,200,1,'ratio','simplB')}
        </div>
        <div class="info-box">
          <div class="info-label">GCD Calculation</div>
          <div style="font-size:13px;color:#94a3b8;line-height:1.8">HCF of ${simplA} and ${simplB} = ${g}<br>
          ${simplA} Ã· ${g} = ${sA}<br>
          ${simplB} Ã· ${g} = ${sB}</div>
        </div>`}
      </div>
      <div class="ctrl-col">
        ${(S.ratio.mode||'share')==='share'?
          fbox(`Share ${total} in ratio ${a}:${b}`,`Each part = ${total} Ã· ${a+b} = ${r2(total/(a+b))}`,`A gets ${shareA}, B gets ${shareB}`,'indigo')+
          steps([
            {t:'Add ratio parts',c:`${a} + ${b} = ${a+b} parts total`},
            {t:'Value of one part',c:`${total} Ã· ${a+b} = ${r2(total/(a+b))}`},
            {t:'Share A',c:`${a} Ã— ${r2(total/(a+b))} = ${shareA}`},
            {t:'Share B',c:`${b} Ã— ${r2(total/(a+b))} = ${shareB}`},
          ]):
          fbox(`Simplify ${simplA} : ${simplB}`,'Divide both by HCF',`${sA} : ${sB}`,'emerald')+
          steps([
            {t:'Find HCF',c:`HCF of ${simplA} and ${simplB} = ${g}`},
            {t:'Divide first',c:`${simplA} Ã· ${g} = ${sA}`},
            {t:'Divide second',c:`${simplB} Ã· ${g} = ${sB}`},
            {t:'Simplified ratio',c:`${sA} : ${sB}`},
          ])
        }
      </div>
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROBABILITY (NEW)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderProbability(){
  const {mode,balls,picked}=S.prob;
  const colorMap={red:'#f43f5e',blue:'#6366f1',green:'#10b981',yellow:'#f59e0b',purple:'#a78bfa'};
  const colorNames=Object.keys(colorMap);
  const counts={};
  balls.forEach(b=>counts[b]=(counts[b]||0)+1);
  const total=balls.length;

  // Single event
  const singleProbs=Object.entries(counts).map(([col,cnt])=>({
    col, cnt, prob:`${cnt}/${total}`, dec:r2(cnt/total)
  }));

  // Combined (two draws with replacement)
  let combinedHTML='';
  if(mode==='combined'){
    combinedHTML=`<div class="info-box" style="margin-top:12px">
      <div class="info-label">Two Draws (with replacement)</div>
      ${singleProbs.slice(0,3).map(p=>`
        <div style="font-size:13px;color:#94a3b8;margin-bottom:4px">
          P(${p.col} then ${p.col}) = ${p.cnt}/${total} Ã— ${p.cnt}/${total} = <span style="color:${colorMap[p.col]};font-weight:700">${r2((p.cnt/total)*(p.cnt/total))}</span>
        </div>`).join('')}
    </div>`;
  }

  return pageWrap('Probability','ğŸ²','Explore probability with coloured balls.',`
    ${tabs([['single','Single Event'],['combined','Combined Events']],mode,"S.prob.mode=__V__;rerender()")}
    <div class="two-col">
      <div>
        <div class="card" style="margin-bottom:16px">
          <div class="info-label" style="margin-bottom:12px">Bag of Balls (click to remove, + to add)</div>
          <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px">
            ${balls.map((col,i)=>`
              <div class="prob-ball" style="background:${colorMap[col]};border-color:${colorMap[col]}"
                onclick="S.prob.balls.splice(${i},1);rerender()" title="Click to remove">${col[0].toUpperCase()}</div>
            `).join('')}
          </div>
          <div style="display:flex;gap:6px;flex-wrap:wrap">
            ${colorNames.map(col=>`
              <button class="btn" style="background:${colorMap[col]}22;border:1px solid ${colorMap[col]}55;color:${colorMap[col]};font-size:12px"
                onclick="if(S.prob.balls.length<20)S.prob.balls.push('${col}');rerender()">+ ${col}</button>
            `).join('')}
          </div>
        </div>
        <div class="info-box">
          <div class="info-label">Ball Counts</div>
          ${Object.entries(counts).map(([col,cnt])=>`
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
              <div style="display:flex;align-items:center;gap:8px">
                <div style="width:14px;height:14px;border-radius:50%;background:${colorMap[col]}"></div>
                <span style="font-size:13px;color:#e2e8f0">${col}</span>
              </div>
              <span class="mono" style="font-size:13px;color:${colorMap[col]}">${cnt}/${total} = ${r2(cnt/total)}</span>
            </div>`).join('')}
        </div>
      </div>
      <div class="ctrl-col">
        ${singleProbs.map(p=>fbox(`P(${p.col})`,`${p.cnt} ${p.col} out of ${total}`,p.prob+' = '+p.dec,p.col==='red'?'rose':p.col==='blue'?'indigo':p.col==='green'?'emerald':'amber')).join('')}
        ${combinedHTML}
        ${steps([
          {t:'Count total balls',c:`Total = ${total} balls`},
          {t:'Count favourable',c:singleProbs.map(p=>`${p.col}: ${p.cnt}`).join(', ')},
          {t:'Write probability',c:singleProbs.map(p=>`P(${p.col}) = ${p.prob} = ${p.dec}`).join(' | ')},
        ])}
      </div>
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CIRCLES (NEW)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCircles(){
  const {r,mode,sector}=S.circle;
  const PI=Math.PI;
  const area=r2(PI*r*r), circ=r2(2*PI*r);
  const arcLen=r2((sector/360)*2*PI*r);
  const secArea=r2((sector/360)*PI*r*r);
  const svgW=320, svgH=320, cx=160, cy=160;
  const scale=Math.min(130/r,14);
  const svgR=r*scale;
  const angRad=(sector-90)*PI/180;
  const secX=cx+svgR*Math.cos(-PI/2);
  const secY=cy+svgR*Math.sin(-PI/2);
  const secX2=cx+svgR*Math.cos(angRad-PI/2);
  const secY2=cy+svgR*Math.sin(angRad-PI/2);
  const lg=sector>180?1:0;
  const circleSVG=`<svg width="${svgW}" height="${svgH}" viewBox="0 0 ${svgW} ${svgH}" style="background:#060b14;border-radius:12px;display:block;max-width:100%">
    ${mode==='sector'?`
      <path d="M ${cx} ${cy} L ${secX} ${secY} A ${svgR} ${svgR} 0 ${lg} 1 ${secX2} ${secY2} Z"
        fill="rgba(99,102,241,.25)" stroke="#818cf8" stroke-width="2"/>
      <circle cx="${cx}" cy="${cy}" r="${svgR}" fill="none" stroke="#334155" stroke-width="1.5" stroke-dasharray="5,4"/>
      <line x1="${cx}" y1="${cy}" x2="${secX}" y2="${secY}" stroke="#818cf8" stroke-width="1.5"/>
      <line x1="${cx}" y1="${cy}" x2="${secX2}" y2="${secY2}" stroke="#818cf8" stroke-width="1.5"/>
      <text x="${cx}" y="${cy+svgR/2}" text-anchor="middle" fill="#818cf8" font-size="12" font-weight="600" font-family="Space Grotesk">${sector}Â°</text>`:`
      <circle cx="${cx}" cy="${cy}" r="${svgR}" fill="rgba(99,102,241,.15)" stroke="#818cf8" stroke-width="2.5"/>
      <line x1="${cx}" y1="${cy}" x2="${cx+svgR}" y2="${cy}" stroke="#f59e0b" stroke-width="1.5" stroke-dasharray="4,3"/>
      <text x="${cx+svgR/2}" y="${cy-8}" text-anchor="middle" fill="#f59e0b" font-size="12" font-weight="600" font-family="Space Grotesk">r=${r}</text>`}
    <circle cx="${cx}" cy="${cy}" r="4" fill="#f43f5e"/>
  </svg>`;
  return pageWrap('Circles','â­•','Explore circle calculations interactively.',`
    ${tabs([['full','Full Circle'],['sector','Sector']],mode,"S.circle.mode=__V__;rerender()")}
    <div class="two-col">
      <div>
        ${circleSVG}
        <div class="card" style="margin-top:16px">
          ${SI('Radius (r)','#818cf8',r,1,15,0.5,'circle','r')}
          ${mode==='sector'?SI('Sector Angle (Â°)','#f59e0b',sector,1,360,5,'circle','sector'):''}
        </div>
      </div>
      <div class="ctrl-col">
        ${mode==='full'?`
          ${fbox('Area','A = Ï€ Ã— rÂ²',area+' sq units','indigo')}
          ${fbox('Circumference','C = 2 Ã— Ï€ Ã— r',circ+' units','emerald')}
          ${steps([
            {t:'Area formula',c:'A = Ï€ Ã— rÂ²'},
            {t:'Substitute r',c:`A = Ï€ Ã— ${r}Â² = Ï€ Ã— ${r*r}`},
            {t:'Calculate',c:`A = ${area} sq units`},
            {t:'Circumference',c:`C = 2 Ã— Ï€ Ã— ${r} = ${circ} units`},
          ])}`:
          `${fbox('Arc Length','L = (Î¸/360) Ã— 2Ï€r',arcLen+' units','indigo')}
          ${fbox('Sector Area','A = (Î¸/360) Ã— Ï€rÂ²',secArea+' sq units','emerald')}
          ${steps([
            {t:'Fraction of circle',c:`${sector}/360 = ${r2(sector/360)}`},
            {t:'Arc length',c:`${r2(sector/360)} Ã— 2Ï€ Ã— ${r} = ${arcLen}`},
            {t:'Sector area',c:`${r2(sector/360)} Ã— Ï€ Ã— ${r}Â² = ${secArea}`},
          ])}`}
        <div class="info-box">
          <div class="info-label">Circle Facts</div>
          <div style="font-size:13px;color:#94a3b8;line-height:1.8">
            Ï€ â‰ˆ 3.14159<br>
            Diameter = 2r = ${r2(2*r)}<br>
            Area = ${area} | Circumference = ${circ}
          </div>
        </div>
      </div>
    </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ROUTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PAGES = {
  dashboard: renderDashboard,
  gradient: renderGradient,
  midpoint: renderMidpoint,
  bearings: renderBearings,
  area: renderArea,
  prisms: renderPrisms,
  linear: renderLinear,
  units: renderUnits,
  parallelogram: renderParallelogram,
  transformations: renderTransformations,
  percentages: renderPercentages,
  ratio: renderRatio,
  probability: renderProbability,
  circles: renderCircles,
};

function navigate(page){
  if(_dragCleanup){ _dragCleanup(); _dragCleanup=null; }
  PAGE=page;
  window.scrollTo(0,0);
  rerender();
}

function rerender(){
  document.getElementById('app').innerHTML=(PAGES[PAGE]||renderDashboard)();
  // sync all sliders with their number inputs after render
  document.querySelectorAll('input[type=range]').forEach(sl=>{
    const numInput=sl.closest('.si-controls')?.previousElementSibling?.querySelector('input[type=number]');
    if(numInput) numInput.value=sl.value;
  });
}

window.navigate=navigate;
window.rerender=rerender;
window.S=S;

rerender();
</script>
</body>
</html>
